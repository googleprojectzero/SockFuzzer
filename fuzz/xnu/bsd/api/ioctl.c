/*
 * Copyright 2021 Google LLC
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_START@
 *
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. The rights granted to you under the License
 * may not be used to create, or enable the creation or redistribution of,
 * unlawful or unlicensed copies of an Apple operating system, or to
 * circumvent, violate, or enable the circumvention or violation of, any
 * terms of an Apple operating system software license agreement.
 *
 * Please obtain a copy of the License at
 * http://www.opensource.apple.com/apsl/ and read it before using this file.
 *
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 *
 * @APPLE_OSREFERENCE_LICENSE_HEADER_END@
 */

#include "fuzz/xnu/bsd/api/ioctl.h"

#include <sys/ioccom.h>

#include "third_party/xnu/bsd/net/if.h"
#include "third_party/xnu/bsd/net/network_agent.h"
#include "third_party/xnu/bsd/net/pfvar.h"
#include "third_party/xnu/bsd/netinet6/in6_var.h"
#include "third_party/xnu/bsd/netinet6/nd6.h"
#include "third_party/xnu/bsd/sys/sockio.h"

#define SIOCGIFORDER _IOWR('i', 179, struct if_order)

unsigned long ioctls[] = {
    SIOCSHIWAT,
    SIOCGHIWAT,
    SIOCSLOWAT,
    SIOCGLOWAT,
    SIOCATMARK,
    SIOCSPGRP,
    SIOCGPGRP,
    SIOCSIFADDR,
    OSIOCGIFADDR,
    SIOCSIFDSTADDR,
    OSIOCGIFDSTADDR,
    SIOCSIFFLAGS,
    SIOCGIFFLAGS,
    OSIOCGIFBRDADDR,
    SIOCSIFBRDADDR,
    OSIOCGIFCONF,
    OSIOCGIFCONF32,
    OSIOCGIFCONF64,
    OSIOCGIFNETMASK,
    SIOCSIFNETMASK,
    SIOCGIFMETRIC,
    SIOCSIFMETRIC,
    SIOCDIFADDR,
    SIOCAIFADDR,
    SIOCGIFADDR,
    SIOCGIFDSTADDR,
    SIOCGIFBRDADDR,
    SIOCGIFCONF,
    SIOCGIFCONF32,
    SIOCGIFCONF64,
    SIOCGIFNETMASK,
    SIOCADDMULTI,
    SIOCDELMULTI,
    SIOCGIFMTU,
    SIOCSIFMTU,
    SIOCGIFPHYS,
    SIOCSIFPHYS,
    SIOCSIFMEDIA,
    SIOCGIFMEDIA,
    SIOCGIFMEDIA32,
    SIOCGIFMEDIA64,
    SIOCSIFGENERIC,
    SIOCGIFGENERIC,
    SIOCSIFLLADDR,
    SIOCGIFSTATUS,
    SIOCSIFPHYADDR,
    SIOCGIFPSRCADDR,
    SIOCGIFPDSTADDR,
    SIOCDIFPHYADDR,
    SIOCGIFDEVMTU,
    SIOCSIFALTMTU,
    SIOCPROTOATTACH,
    SIOCPROTODETACH,
    SIOCIFCREATE,
    SIOCIFDESTROY,
    SIOCSIFVLAN,
    SIOCGIFVLAN,
    SIOCSETVLAN,
    SIOCGETVLAN,
    SIOCSIFDEVMTU,
    SIOCIFGCLONERS,
    SIOCIFGCLONERS32,
    SIOCIFGCLONERS64,
    SIOCGIFASYNCMAP,
    SIOCSIFASYNCMAP,
    SIOCSIFKPI,
    SIOCGIFKPI,
    SIOCGIFWAKEFLAGS,
    SIOCGIFGETRTREFCNT,
    SIOCGIFLINKQUALITYMETRIC,
    SIOCSETROUTERMODE,
    SIOCGIFEFLAGS,
    SIOCSIFDESC,
    SIOCGIFDESC,
    SIOCSIFLINKPARAMS,
    SIOCGIFLINKPARAMS,
    SIOCGIFQUEUESTATS,
    SIOCSIFTHROTTLE,
    SIOCGIFTHROTTLE,
    SIOCGASSOCIDS,
    SIOCGCONNIDS,
    SIOCGCONNINFO,
    SIOCGASSOCIDS32,
    SIOCGASSOCIDS64,
    SIOCGCONNIDS32,
    SIOCGCONNIDS64,
    SIOCGCONNINFO32,
    SIOCGCONNINFO64,
    SIOCSCONNORDER,
    SIOCGCONNORDER,
    SIOCSIFLOG,
    SIOCGIFLOG,
    SIOCGIFDELEGATE,
    SIOCGIFLLADDR,
    SIOCGIFTYPE,
    SIOCGIFEXPENSIVE,
    SIOCSIFEXPENSIVE,
    SIOCGIF2KCL,
    SIOCSIF2KCL,
    SIOCGSTARTDELAY,
    SIOCAIFAGENTID,
    SIOCDIFAGENTID,
    SIOCGIFAGENTIDS,
    SIOCGIFAGENTDATA,
    SIOCGIFAGENTIDS32,
    SIOCGIFAGENTIDS64,
    SIOCGIFAGENTDATA32,
    SIOCGIFAGENTDATA64,
    SIOCSIFINTERFACESTATE,
    SIOCGIFINTERFACESTATE,
    SIOCSIFPROBECONNECTIVITY,
    SIOCGIFPROBECONNECTIVITY,
    SIOCGIFFUNCTIONALTYPE,
    SIOCSIFNETSIGNATURE,
    SIOCGIFNETSIGNATURE,
    SIOCGECNMODE,
    SIOCSECNMODE,
    SIOCSIFORDER,
    SIOCGIFORDER,
    SIOCSQOSMARKINGMODE,
    SIOCSFASTLANECAPABLE,
    SIOCSQOSMARKINGENABLED,
    SIOCSFASTLEENABLED,
    SIOCGQOSMARKINGMODE,
    SIOCGQOSMARKINGENABLED,
    SIOCSIFTIMESTAMPENABLE,
    SIOCSIFTIMESTAMPDISABLE,
    SIOCGIFTIMESTAMPENABLED,
    SIOCSIFDISABLEOUTPUT,
    SIOCGIFAGENTLIST,
    SIOCGIFAGENTLIST32,
    SIOCGIFAGENTLIST64,
    SIOCSIFLOWINTERNET,
    SIOCGIFLOWINTERNET,
    SIOCGIFNAT64PREFIX,
    SIOCSIFNAT64PREFIX,
    SIOCGIFNEXUS,
    SIOCSIFADDR_IN6,
    SIOCGIFADDR_IN6,
    SIOCSIFDSTADDR_IN6,
    SIOCSIFNETMASK_IN6,
    SIOCGIFDSTADDR_IN6,
    SIOCGIFNETMASK_IN6,
    SIOCDIFADDR_IN6,
    SIOCAIFADDR_IN6,
    SIOCAIFADDR_IN6_32,
    SIOCAIFADDR_IN6_64,
    SIOCSIFPHYADDR_IN6,
    SIOCSIFPHYADDR_IN6_32,
    SIOCSIFPHYADDR_IN6_64,
    SIOCGIFPSRCADDR_IN6,
    SIOCGIFPDSTADDR_IN6,
    SIOCGIFAFLAG_IN6,
    SIOCGDRLST_IN6,
    SIOCGDRLST_IN6_32,
    SIOCGDRLST_IN6_64,
    SIOCGPRLST_IN6,
    SIOCGPRLST_IN6_32,
    SIOCGPRLST_IN6_64,
    OSIOCGIFINFO_IN6,
    SIOCGIFINFO_IN6,
    SIOCSNDFLUSH_IN6,
    SIOCGNBRINFO_IN6,
    SIOCGNBRINFO_IN6_32,
    SIOCGNBRINFO_IN6_64,
    SIOCSPFXFLUSH_IN6,
    SIOCSRTRFLUSH_IN6,
    SIOCGIFALIFETIME_IN6,
    SIOCSIFALIFETIME_IN6,
    SIOCGIFSTAT_IN6,
    SIOCGIFSTAT_ICMP6,
    SIOCSDEFIFACE_IN6,
    SIOCGDEFIFACE_IN6,
    SIOCSDEFIFACE_IN6_32,
    SIOCSDEFIFACE_IN6_64,
    SIOCGDEFIFACE_IN6_32,
    SIOCGDEFIFACE_IN6_64,
    SIOCSIFINFO_FLAGS,
    SIOCSSCOPE6,
    SIOCGSCOPE6,
    SIOCGSCOPE6DEF,
    SIOCSIFPREFIX_IN6,
    SIOCGIFPREFIX_IN6,
    SIOCDIFPREFIX_IN6,
    SIOCAIFPREFIX_IN6,
    SIOCCIFPREFIX_IN6,
    SIOCSGIFPREFIX_IN6,
    SIOCAADDRCTL_POLICY,
    SIOCDADDRCTL_POLICY,
    SIOCPROTOATTACH_IN6,
    SIOCPROTOATTACH_IN6_32,
    SIOCPROTOATTACH_IN6_64,
    SIOCPROTODETACH_IN6,
    SIOCLL_START,
    SIOCLL_START_32,
    SIOCLL_START_64,
    SIOCLL_STOP,
    SIOCAUTOCONF_START,
    SIOCAUTOCONF_STOP,
    SIOCDRADD_IN6,
    SIOCDRADD_IN6_32,
    SIOCDRADD_IN6_64,
    SIOCDRDEL_IN6,
    SIOCDRDEL_IN6_32,
    SIOCDRDEL_IN6_64,
    SIOCSETROUTERMODE_IN6,
    SIOCLL_CGASTART,
    SIOCLL_CGASTART_32,
    SIOCLL_CGASTART_64,
    SIOCGIFCGAPREP_IN6,
    SIOCSIFCGAPREP_IN6,
    DIOCSTART,
    DIOCSTOP,
    DIOCADDRULE,
    DIOCGETSTARTERS,
    DIOCGETRULES,
    DIOCGETRULE,
    DIOCSTARTREF,
    DIOCSTOPREF,
    DIOCCLRSTATES,
    DIOCGETSTATE,
    DIOCSETSTATUSIF,
    DIOCGETSTATUS,
    DIOCCLRSTATUS,
    DIOCNATLOOK,
    DIOCSETDEBUG,
    DIOCGETSTATES,
    DIOCCHANGERULE,
    DIOCINSERTRULE,
    DIOCDELETERULE,
    DIOCSETTIMEOUT,
    DIOCGETTIMEOUT,
    DIOCADDSTATE,
    DIOCCLRRULECTRS,
    DIOCGETLIMIT,
    DIOCSETLIMIT,
    DIOCKILLSTATES,
    DIOCSTARTALTQ,
    DIOCSTOPALTQ,
    DIOCADDALTQ,
    DIOCGETALTQS,
    DIOCGETALTQ,
    DIOCCHANGEALTQ,
    DIOCGETQSTATS,
    DIOCBEGINADDRS,
    DIOCADDADDR,
    DIOCGETADDRS,
    DIOCGETADDR,
    DIOCCHANGEADDR,
    DIOCGETRULESETS,
    DIOCGETRULESET,
    DIOCRCLRTABLES,
    DIOCRADDTABLES,
    DIOCRDELTABLES,
    DIOCRGETTABLES,
    DIOCRGETTSTATS,
    DIOCRCLRTSTATS,
    DIOCRCLRADDRS,
    DIOCRADDADDRS,
    DIOCRDELADDRS,
    DIOCRSETADDRS,
    DIOCRGETADDRS,
    DIOCRGETASTATS,
    DIOCRCLRASTATS,
    DIOCRTSTADDRS,
    DIOCRSETTFLAGS,
    DIOCRINADEFINE,
    DIOCOSFPFLUSH,
    DIOCOSFPADD,
    DIOCOSFPGET,
    DIOCXBEGIN,
    DIOCXCOMMIT,
    DIOCXROLLBACK,
    DIOCGETSRCNODES,
    DIOCCLRSRCNODES,
    DIOCSETHOSTID,
    DIOCIGETIFACES,
    DIOCSETIFFLAG,
    DIOCCLRIFFLAG,
    DIOCKILLSRCNODES,
    DIOCGIFSPEED,
};

const int num_ioctls = sizeof(ioctls) / sizeof(unsigned long);

// Export these enums so they are accessible outside libxnu.
const unsigned long siocaifaddr_in6_64 = SIOCAIFADDR_IN6_64;
const unsigned long siocsifflags = SIOCSIFFLAGS;
